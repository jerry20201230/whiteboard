<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>白板 - 即時線上協作</title>
  <link rel="stylesheet" href="style.css">
  <link id="browser-icon" rel="shortcut icon" type="image/png" href="/icon/icon-white.png" />

  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.css' integrity='sha512-h1rwF0uB6r2IuEZcyjPrR53bBKN9Wb4yL+w3Rdlzmc3CkBF1gMSFvQIIstnu4bEtYDaKca5ke5S8UBAACRImyg==' crossorigin='anonymous'/>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.css' integrity='sha512-CaTMQoJ49k4vw9XO0VpTBpmMz8XpCWP5JhGmBvuBqCOaOHWENWO1CrVl09u4yp8yBVSID6smD4+gpzDJVQOPwQ==' crossorigin='anonymous'/>
  
  <style>
    body {
        margin: 8px;
        padding-bottom: 3rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    nav {
        position: sticky;
        width: 100%;
        top: 0;
    }

    .bottom {
        position: fixed;
        bottom: 0;

    }

    .bottom-bar {
        background: rgba(0, 0, 0, 0.15);
        padding: 0.25rem;

        display: flex;
        height: 3rem;
        box-sizing: border-box;
        backdrop-filter: blur(10px);
    }

    .input {
        border: none;
        padding: 0 1rem;
        flex-grow: 1;
        border-radius: 2rem;
        margin: 0.25rem;
    }

    .input:focus {
        outline: none;
    }

    .msg-form {

        display: flex;
    }

    .messages,
    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    .messages>li {
        padding: 0.5rem 1rem;
        border-bottom: 1px #333 solid;
    }


    .statue-bar {
        position: sticky;
        top: 0px;
        background-color: #fff;


    }

    .flex {
        display: flex;
    }

    .warn {
        background-color: #f4a3ab !important;
    }

    .success {
        background-color: #98f9b1 !important;
    }

    .info {
        background-color: #94e3ff !important;
    }


    table,
    td {
        border: 1px solid #333;
    }

    thead,
    tfoot {
        background-color: #333;
        color: #fff;
    }

    .btn-file {
        position: relative;
        overflow: hidden;
    }

    .btn-file input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        min-width: 100%;
        min-height: 100%;
        font-size: 100px;
        text-align: right;
        filter: alpha(opacity=0);
        opacity: 0;
        outline: none;
        background: white;
        cursor: inherit;
        display: block;
    }


    .text {
        border: 1px #333 solid;
        border-radius: 5px;
        max-height: 50vh;
        /*   max-width: 30vw;*/
    }

    .badge>h6 {
        margin: 0;
    }

    .radio input[type="radio"] {
        display: none;
    }

    .checkbox input[type="checkbox"] {
        display: none;
    }

    .radio input:checked+.button {
        background: #3296d4;
        color: #fff;
        cursor: default;
    }

    .checkbox input:checked+.button {
        background: #3296d4;
        color: #fff;
        cursor: pointer;

    }

    .radio .button,
    .checkbox .button {
        display: inline-block;


        margin: 0 0.5vw 0.5vw 0;
        padding: 0.25vw 0.5vw;
        background: #f7f7f7;
        color: #333;
        cursor: pointer;
        border: 1px solid #8b8b8b;
        transition: background-color 0.3s, color 0.3s;
    }

    .radio .button:hover,
    .checkbox .button:hover {
        background-color: #bbb;
        color: #fff;
    }

    .radio .round,
    .checkbox .round {
        border-radius: 5px;
    }

    .tab-content {
        flex-grow: 1;
        padding-top: 5px;
    }

    #v-pills-tab {
        position: sticky !important;
        padding-top: 5px;

        overflow-x: hidden;
        flex-wrap: nowrap;


        overflow-y: scroll !important;
        max-height: 80vh;

    }

    #v-pills-tab .nav-link {
        white-space: nowrap;
    }

    #toast {
        z-index: 20000 !important;
    }
</style>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

</head>

<body>

  <div class="collapse" id="navbarToggleExternalContent">
    <div class="bg-dark p-4">
        <div>

            <div class="flex">
                <div id="chat-tabs">


                </div>
                <div class="flex">
                    <div>
                        <div class="position-relative">
                            <svg xmlns="http://www.w3.org/2000/svg" style="width: 3em; height:3em; color:#fff"
                                fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                                <path fill-rule="evenodd"
                                    d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                            </svg>
                            <span id="statue-circle"
                                class="position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle">

                            </span>
                        </div>
                    </div>


                    <ul style="color: #fff; margin-left: 1em;">
                        <li hidden>
                            <form id="rename_nickname_farm" action="">
                                暱稱:<input id="NMinput" placeholder="輸入暱稱..." value="User">
                                <button id="changeNM" class="btn btn-outline-light">送出更改</button>
                            </form>
                        </li>
                        <li>
                            <h3 class="nickname"></h3>
                            <div class="flex">
                                <h6>@</h6>
                                <h6 id="Sid" style="margin:0">---</h6>
                            </div>
                        </li>
                        <li>
                            <form id="reset_statue_farm" action="">
                                狀態:
                                <select id="statue_select" style="
        background-color: rgba(var(--bs-dark-rgb),var(--bs-bg-opacity)) !important;
        color: inherit;" onblur="
        if(this.value.includes('statue_Green')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle')}
        else if(this.value.includes('statue_Yellow')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-warning border border-light rounded-circle')}
        else if(this.value.includes('statue_White')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-light border border-light rounded-circle')}
        else if(this.value.includes('statue_Red')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle')}
        else if(this.value.includes('statue_Blue')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-primary border border-light rounded-circle')}
        ">
                                    <option value="statue_Green:online">線上🟢</option>
                                    <option value="statue_Yellow:leave">離開🟡</option>
                                    <option value="statue_Red:busy">忙碌🔴</option>
                                    <option value="statue_White:disconnect">離線⚪</option>
                                </select>


                            </form>

                        </li>



                        <li>連線狀態: &nbsp; <span id="connectStatue">未連線</span>
                        </li>
                        <li class="flex"><span>線上人數:&nbsp;</span><span class="onlinePeople">未知</span></li>
                    </ul>


                </div>

            </div>

            <div class="flex">
                <button class="btn btn-outline-light"
                    onclick="$('#getuser-connecting').show();socket.emit('GetUsers',{'room':MyRoom})"
                    data-bs-toggle="modal" data-bs-target="#Modal-1">人員清單</button>

                &nbsp;

                <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#Modal-5" onclick='    $(".nickname").html(localStorage.getItem("myNickname"))
    $(".Sid").html(localStorage.getItem("myID"))'>設定</button>

  
            </div>

        </div>
    </div>



</div>

<nav class="navbar navbar-dark bg-dark flex" style="position: sticky;
width: 100%;
top: 0;
z-index: 1050;" hidden>

    <div class="container-fluid" >
        <h1 style="color:#fff">White Board</h1>
        <button class="navbar-toggler" type="button" onclick="window.scrollTo(0,0)" data-bs-toggle="collapse"
            data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

    </div>
</nav>


<p></p>

<!--MAIN UI-->
  <div id="logined-ui" >


    <center>
    <canvas class="whiteboard" style="border: 1px #000 solid; display: none;"></canvas>
    <div id="whiteboard-loading" style="padding: 10%; border: 1px #000 solid;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">正在同步資料...</span>
          </div>
          <p></p>
        <span>正在同步資料...</span>
    </div>
    </center>
    <p></p>
    <div class="flex">
      <input type="text" id="color-picker" value="#000000FF"
        data-jscolor="{closeButton:true, closeText:'關閉',backgroundColor:'#000', buttonColor:'#fff'}">
        
    </div>
<span id="infoText" >正在同步...</span>
  </div>

  <div id="login-user-setting-page" style="display: none;">
<h1>Hi ~ 歡迎使用畫板</h1>
    
   <div class="input-group mb-3">
    <span class="input-group-text">輸入暱稱</span>
    <input type="text" id="nickname-input-set"
    onblur="if($(this).val()==''){$(this).attr('class','form-control is-invalid')}else{$(this).attr('class','form-control')}"
    class="form-control" placeholder="輸入暱稱" aria-label="輸入暱稱" >

    <div class="invalid-feedback">
       請輸入暱稱
      </div>
    </div>
    <p>
        <button class="btn btn-outline-primary" onclick="if($('#nickname-input-set').val()==''){$('#nickname-input-set').attr('class','form-control is-invalid')}else{$('#nickname-input-set').attr('class','form-control');$('#login-robot-verify-page').show();$('#login-user-setting-page').hide()}">> 下一步</button>

    </p>

  </div>

<div id="login-robot-verify-page" style="display: none;">
   <h1><span class="user-nickname"></span> ，請勾選核取方塊以完成認證</h1>
    <p></p>
    <div
    class="g-recaptcha"
    data-sitekey="6LcJwl4hAAAAADWzbkUuYV1CSFW0g6CMs9ZoVaaS"
    data-theme="dark" data-size="normal"
    data-callback="verify"
    data-expired-callback="expired"
    data-error-callback="error">
    </div>
   
</div>


   
</div>



  <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/js/bootstrap.js' integrity='sha512-39Q5Yw4jtWPVkYu5Dry3HiRh6DWG4FDODb/rHF+X2Xp0kzhg9VgTyYV209uQ/EsqPDP/4dDvwm1rb8JgnAkHNg==' crossorigin='anonymous'></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.8/jscolor.js'
    integrity='sha512-mtiG+kTbrG6RDYwzcVr6S3kIhSsdAkuft9To1ILQklUSoiBRysnRoqEz6qdJPgLz1ecmndQmTITjCi9jmjRe6w=='
    crossorigin='anonymous'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js'
    integrity='sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g=='
    crossorigin='anonymous'></script>

  <script src="/main.js"></script>
  <script>
    if(localStorage.getItem("logined?") == null ){

        $("#login-user-setting-page").show()

    }else{
        $("#login-robot-verify-page").show()
        $(".user-nickname").text(localStorage.getItem('user_name'))

    }
 var uriIP = 'https://www.cloudflare.com/cdn-cgi/trace';
      
      // GAS 部署為網路應用程式後取得的 URL
      var uriGAS = 'https://script.google.com/macros/s/AKfycbzl4lhlnlRV30ODAmuJzgcteMb4O7Wd1mvw0a_Bwu1_RTFpdXO4UFiDzRq3ngockVLd/exec';
      
      // 取 ip
      var myip,isRobot=-1;
      fetch(uriIP)
        .then(response => response.text())
        .then(result => {
          var resultArr = result.split('\n');
          for(var i = 0, len = resultArr.length; i < len; i++)	{
            var tempArr = resultArr[i].split('=');
            if(tempArr[0] == 'ip') {
              myip = tempArr[1];
              break;
            }
          }
        })
        .catch(err => {
          window.alert(err)
        });
      
      // 方法 1：reCAPTCHA 送到後端做驗證
      function verifyCallback(token) {
      
        var formData = new FormData();
        formData.append('token', token);
        formData.append('ip', myip);
      
        fetch(uriGAS, {
          method: "POST",
          body: formData
        }).then(response => response.json())
          .then(result => {
            if(result.success) {
              isRobot = 0
            } else {
              //window.alert(result['error-codes'][0])
              isRobot = 1
            }
          })
          .catch(err => {
            isRobot = -1
            //window.alert(err)
          })
      }
      
      // 過期要做的事
      function expired(ex) {
        isRobot = -1
       // window.alert('reCAPTCHA 驗證程序到期')
      }
      
      // 失敗要做的事
      function error(err) {
        isRobot = 1
       // window.alert('reCAPTCHA 驗證失敗')
      }
</script>
</body>

</html>